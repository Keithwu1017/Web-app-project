<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <style>
        .nav-item {
            padding: 10px;
        }
        .reader-container {
            width: 80%;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .title{
            display: flex;
            justify-content: center;
        }
        .page {
            display: none;
        }
        .page.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        img {
            max-width: 100%;
            width: auto;
            height: auto;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <span class="navbar-brand mx-4 my-3">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-book-half" viewBox="0 0 16 16">
            <path d="M8.5 2.687c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783"/>
          </svg>
        </span>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end mx-3" id="navbarNav">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="{% url 'index' %}">首頁</a>
            </li>
            {% if user.username %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'logout' %}">登出</a>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'login' %}">登入</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'register' %}">註冊</a>
            </li>
            {% endif %}
            {% if user.username %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'account' %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                </svg>
                  {{ user.username }}
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </nav>

<div class="title">
<h1>{{ book.title }}</h1>
</div>
<div class="title">
<h3>{{ book.author }}</h3>
</div>

<div class="reader-container">
    {% for picture in book.pictures.all %}
    {% if forloop.first %}
    <div class="page active" id="page-1">
        <img src="{{ picture.image.url }}" alt="Page {{ picture.page_number }}">
    </div>
    {% else %}
    <div class="page" id="page-{{ picture.page_number }}">
        <img src="{{ picture.image.url }}" alt="Page {{ picture.page_number }}">
    </div>
    {% endif %}
    {% endfor %}
    <div class="controls">
        <button class="btn btn-primary" id="prev">上一頁</button>
        <div>
            跳到第 <input type="number" id="page-number" name="page" class="form-control d-inline-block" style="width: 70px;" min="1" value="1"> 頁
            <button class="btn btn-secondary" id="go">跳轉</button>
        </div>
        <button class="btn btn-primary" id="next">下一頁</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    let currentPage = 1;
    const totalPages = document.querySelectorAll('.page').length;

    function showPage(page) {
        document.querySelectorAll('.page').forEach((el, index) => {
            el.classList.toggle('active', index === page - 1);
        });
    }

    document.getElementById('prev').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            showPage(currentPage);
            document.getElementById('page-number').value = currentPage;
        }
    });

    document.getElementById('next').addEventListener('click', () => {
        if (currentPage < totalPages) {
            currentPage++;
            showPage(currentPage);
            document.getElementById('page-number').value = currentPage;
        }
    });

    document.getElementById('go').addEventListener('click', () => {
        const pageNumber = parseInt(document.getElementById('page-number').value);
        if (pageNumber >= 1 && pageNumber <= totalPages) {
            currentPage = pageNumber;
            showPage(currentPage);
        }
    });

    showPage(currentPage);
</script>

</body>
</html>
